- ruleID: fips-go-pqc-exp-00100
  labels:
    - "konveyor.io/target=go"
  effort: 3
  category: mandatory
  description: "Unacceptable: CurvePreferences may block post-quantum key exchange"
  when:
    or:
      - builtin.filecontent:
          pattern: 'CurvePreferences\s*:\s*\[\]tls\.CurveID\s*\{'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: '\.CurvePreferences\s*=\s*\[\]tls\.CurveID\s*\{'
          filePattern: "*.go"
  message: |
    PQC Blocking Configuration. Explicit CurvePreferences may block post-quantum
    key exchange in TLS connections.

    In Go 1.24+, the default CurvePreferences includes X25519MLKEM768 (hybrid PQC).
    When you explicitly set CurvePreferences, you override this default.

    Problematic pattern:
      tls.Config{
          CurvePreferences: []tls.CurveID{tls.X25519, tls.CurveP256},
      }

    This blocks:
    - X25519MLKEM768 (Go 1.24+ hybrid PQC)
    - Future post-quantum key exchange mechanisms

    Action: Either:
    1. Remove CurvePreferences to use secure defaults (recommended)
    2. Include tls.X25519MLKEM768 in the list (Go 1.24+)
    3. Load curve preferences from platform configuration

    For PQC readiness, avoid hardcoding curve preferences.
  links:
    - title: "Go crypto/tls Documentation"
      url: "https://pkg.go.dev/crypto/tls"
  tag:
    - "PQC=Blocking"
    - "TLS=CurvePreferences"
    - "FIPS-140=Unacceptable"

- ruleID: fips-go-pqc-exp-00101
  labels:
    - "konveyor.io/target=go"
  effort: 2
  category: potential
  description: "Requires Analysis: X25519 without ML-KEM may indicate missing PQC"
  when:
    or:
      - builtin.filecontent:
          pattern: 'tls\.X25519[^M]'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'CurveID.*X25519[,\}]'
          filePattern: "*.go"
  message: |
    X25519 Key Exchange Without PQC. Detected X25519 usage that may not include
    the hybrid post-quantum variant.

    Go 1.24+ provides:
    - tls.X25519 (classical, quantum-vulnerable)
    - tls.X25519MLKEM768 (hybrid, quantum-resistant)

    If CurvePreferences explicitly lists X25519 without X25519MLKEM768,
    post-quantum protection is not enabled.

    Action: Review TLS configuration:
    - For Go 1.24+: Ensure X25519MLKEM768 is included or use defaults
    - For Go 1.23: X25519Kyber768Draft00 was experimental
    - For older Go: Consider upgrading for PQC support
  tag:
    - "PQC=Requires-Analysis"
    - "TLS=X25519"
