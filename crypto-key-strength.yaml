- ruleID: fips-go-keysize-00100
  labels:
    - "konveyor.io/target=go"
  effort: 3
  category: mandatory
  description: "Unacceptable: Weak RSA key size detected (< 2048 bits)"
  when:
    or:
      - builtin.filecontent:
          pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*512\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*1024\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*1536\s*\)'
          filePattern: "*.go"
  message: |
    Weak RSA Key Size. RSA keys less than 2048 bits are not FIPS 140 compliant.

    Key strength requirements:
    - 512-bit RSA: Trivially broken (minutes to factor)
    - 1024-bit RSA: Deprecated since 2013, breakable by nation-states
    - 1536-bit RSA: Non-standard, not FIPS approved
    - 2048-bit RSA: Minimum for FIPS 140 (until ~2030)
    - 3072-bit RSA: Recommended for long-term security
    - 4096-bit RSA: Maximum practical security

    NIST SP 800-131A requires minimum 2048-bit RSA keys.

    Action: Use at least 2048-bit RSA keys:
      privateKey, err := rsa.GenerateKey(rand.Reader, 2048)

    For new systems, consider 3072-bit or ECDSA P-256.
  links:
    - title: "NIST SP 800-131A Rev 2"
      url: "https://csrc.nist.gov/publications/detail/sp/800-131a/rev-2/final"
  tag:
    - "FIPS-140=Unacceptable"
    - "Crypto=Weak-RSA"
    - "CWE=CWE-326"
    - "PQC=Quantum-Vulnerable"

- ruleID: fips-go-keysize-00101
  labels:
    - "konveyor.io/target=go"
  effort: 1
  category: potential
  description: "Acceptable: RSA 2048-bit key detected - minimum FIPS compliant"
  when:
    builtin.filecontent:
      pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*2048\s*\)'
      filePattern: "*.go"
  message: |
    RSA 2048-bit Key. This is the minimum FIPS 140 compliant RSA key size.

    Notes:
    - NIST approved until approximately 2030
    - Consider 3072-bit for longer-term security
    - RSA is vulnerable to quantum computers (Shor's algorithm)

    For PQC readiness:
    - Plan migration path to post-quantum algorithms
    - Consider hybrid schemes for transition period
    - Monitor NIST PQC standardization progress
  tag:
    - "FIPS-140=Acceptable-Evaluate"
    - "Crypto=RSA-2048"
    - "PQC=Migration-Required"

- ruleID: fips-go-keysize-00102
  labels:
    - "konveyor.io/target=go"
  effort: 1
  category: potential
  description: "Acceptable: RSA 3072+ bit key detected - strong key size"
  when:
    or:
      - builtin.filecontent:
          pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*3072\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'rsa\.GenerateKey\s*\([^,]+,\s*4096\s*\)'
          filePattern: "*.go"
  message: |
    Strong RSA Key Size. 3072-bit and 4096-bit RSA keys provide strong security.

    Notes:
    - 3072-bit: Equivalent to 128-bit symmetric security
    - 4096-bit: Stronger, but slower operations
    - Both are FIPS 140 compliant

    PQC Consideration:
    - RSA of any size is vulnerable to quantum computers
    - Larger keys do not protect against quantum attacks
    - Plan migration to post-quantum algorithms
  tag:
    - "FIPS-140=Acceptable-Evaluate"
    - "Crypto=RSA-Strong"
    - "PQC=Migration-Required"

- ruleID: fips-go-keysize-00200
  labels:
    - "konveyor.io/target=go"
  effort: 2
  category: potential
  description: "Requires Analysis: AES key size detection"
  when:
    or:
      - builtin.filecontent:
          pattern: 'make\s*\(\s*\[\]byte\s*,\s*16\s*\)[^)]*aes\.NewCipher'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'make\s*\(\s*\[\]byte\s*,\s*24\s*\)[^)]*aes\.NewCipher'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'make\s*\(\s*\[\]byte\s*,\s*32\s*\)[^)]*aes\.NewCipher'
          filePattern: "*.go"
  message: |
    AES Key Size Detection. AES supports 128, 192, and 256-bit keys.

    All AES key sizes are FIPS 140 approved:
    - AES-128 (16 bytes): 128-bit security, fastest
    - AES-192 (24 bytes): 192-bit security
    - AES-256 (32 bytes): 256-bit security, recommended for high-security

    PQC Consideration:
    - AES-128 provides 64-bit security against Grover's algorithm
    - AES-256 provides 128-bit security against quantum attacks
    - For PQC readiness, prefer AES-256

    Action: For quantum-resistant symmetric encryption, use AES-256.
  tag:
    - "FIPS-140=Acceptable-Evaluate"
    - "Crypto=AES-Key-Size"
    - "PQC=AES-256-Recommended"

- ruleID: fips-go-keysize-00300
  labels:
    - "konveyor.io/target=go"
  effort: 2
  category: potential
  description: "Requires Analysis: ECDSA/ECDH curve selection"
  when:
    or:
      - builtin.filecontent:
          pattern: 'elliptic\.P224\s*\(\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'elliptic\.P256\s*\(\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'elliptic\.P384\s*\(\s*\)'
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'elliptic\.P521\s*\(\s*\)'
          filePattern: "*.go"
  message: |
    NIST Elliptic Curve Usage. Detected usage of NIST-approved curves.

    FIPS 140 approved curves:
    - P-224: 112-bit security (minimum, not recommended for new use)
    - P-256: 128-bit security (recommended for most uses)
    - P-384: 192-bit security (high security)
    - P-521: 256-bit security (highest security)

    PQC Consideration:
    - All elliptic curves are vulnerable to quantum computers (Shor's algorithm)
    - Larger curves do not protect against quantum attacks
    - Plan migration to post-quantum algorithms

    For most applications, P-256 provides good balance of security and performance.
  tag:
    - "FIPS-140=Acceptable-Evaluate"
    - "Crypto=NIST-Curves"
    - "PQC=Migration-Required"

- ruleID: fips-go-keysize-00400
  labels:
    - "konveyor.io/target=go"
  effort: 2
  category: potential
  description: "Requires Analysis: Diffie-Hellman parameters"
  when:
    or:
      - builtin.filecontent:
          pattern: 'dh\.GenerateParameters\s*\('
          filePattern: "*.go"
      - builtin.filecontent:
          pattern: 'dsa\.GenerateParameters\s*\('
          filePattern: "*.go"
  message: |
    Diffie-Hellman/DSA Parameter Generation. Review key sizes for FIPS compliance.

    FIPS 140 requirements:
    - DH/DSA L=2048, N=224 minimum
    - DH/DSA L=2048, N=256 recommended
    - DH/DSA L=3072, N=256 for higher security

    PQC Consideration:
    - Discrete log-based algorithms are quantum-vulnerable
    - DH and DSA will be broken by quantum computers
    - Plan migration to post-quantum key exchange

    Action: Verify parameter sizes meet FIPS requirements.
    Consider ECDH P-256 as a more efficient alternative.
  tag:
    - "FIPS-140=Requires-Analysis"
    - "Crypto=DH-Parameters"
    - "PQC=Migration-Required"

- ruleID: fips-go-keysize-00500
  labels:
    - "konveyor.io/target=go"
  effort: 2
  category: potential
  description: "Requires Analysis: PBKDF2 iteration count"
  when:
    builtin.filecontent:
      pattern: 'pbkdf2\.Key\s*\('
      filePattern: "*.go"
  message: |
    PBKDF2 Usage Detected. Verify iteration count meets security requirements.

    NIST SP 800-132 recommendations:
    - Minimum: 1,000 iterations (outdated)
    - OWASP 2023: 600,000 iterations for SHA-256
    - OWASP 2023: 210,000 iterations for SHA-512

    Higher iterations = more secure but slower:
    - Balance security vs. user experience
    - Consider hardware capabilities
    - Re-evaluate periodically as hardware improves

    Action: Use at least 100,000 iterations for SHA-256.
    Consider Argon2id for new password hashing (if FIPS not required).
  links:
    - title: "OWASP Password Storage Cheat Sheet"
      url: "https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html"
  tag:
    - "FIPS-140=Requires-Analysis"
    - "Crypto=PBKDF2-Iterations"
